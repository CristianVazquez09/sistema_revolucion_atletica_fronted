<div class="mx-auto w-full rounded-2xl bg-white shadow-2xl ring-1 ring-black/5">
  <div class="flex items-start justify-between px-6 pt-5">
    <h2 class="text-[20px] font-bold text-ra-slate leading-none">Editar membresía #{{ idMembresia }}</h2>
    <button class="w-8 h-8 grid place-items-center rounded-full bg-red-600 text-white hover:bg-red-700"
            (click)="cancelar.emit()" aria-label="Cerrar">×</button>
  </div>

  <div class="px-6 pb-6 pt-4">
    @if (cargando) {
      <div class="py-6 text-center">Cargando…</div>
    } @else if (error) {
      <div class="py-2 text-sm text-red-600">{{ error }}</div>
    } @else if (data) {

      <!-- Datos fijos -->
      <div class="grid md:grid-cols-2 gap-4 mb-4 text-sm">
        <div>
          <div class="font-semibold text-ra-slate/80">Socio</div>
          <div class="font-medium">{{ data.socio.nombre }} {{ data.socio.apellido }}</div>
          <div class="text-xs text-ra-slate/70 truncate">{{ data.socio.email }}</div>
        </div>
        <div>
          <div class="font-semibold text-ra-slate/80">Paquete</div>
          <div class="font-medium">{{ data.paquete.nombre }}</div>
          <div class="text-xs text-ra-slate/70">Tiempo: {{ data.paquete.tiempo }}</div>
        </div>
        <div>
          <div class="font-semibold text-ra-slate/80">Pagos</div>
          <div class="flex flex-wrap gap-1">
            @for (p of data.pagos; track $index) {
              <span class="inline-flex items-center rounded-full bg-gray-100 text-gray-700 px-2 py-0.5 text-xs">
                {{ p.tipoPago }}: {{ (p.monto || 0) | currency:'MXN':'symbol-narrow':'1.2-2' }}
              </span>
            }
          </div>
        </div>
        <div>
          <div class="font-semibold text-ra-slate/80">Usuario</div>
          <div>{{ data.usuario?.nombreUsuario || '—' }}</div>
        </div>
      </div>

      <!-- Form editable -->
      <form [formGroup]="form" (ngSubmit)="guardar()" class="space-y-3">
        <div class="grid md:grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-semibold text-ra-slate mb-1.5">Fecha inicio</label>
            <input type="date" formControlName="fechaInicio"
                   class="w-full rounded-xl border border-gray-200 bg-gray-100 px-4 py-3 shadow-inner focus:outline-none focus:ring-2 focus:ring-ra-green">
          </div>
          <div>
            <label class="block text-sm font-semibold text-ra-slate mb-1.5">Fecha fin</label>
            <input type="date" formControlName="fechaFin"
                   class="w-full rounded-xl border border-gray-200 bg-gray-100 px-4 py-3 shadow-inner focus:outline-none focus:ring-2 focus:ring-ra-green">
          </div>
        </div>

        <div class="grid md:grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-semibold text-ra-slate mb-1.5">Descuento</label>
            <input type="number" step="0.01" formControlName="descuento"
                   class="w-full rounded-xl border border-gray-200 bg-gray-100 px-4 py-3 shadow-inner focus:outline-none focus:ring-2 focus:ring-ra-green">
          </div>
          <div>
            <label class="block text-sm font-semibold text-ra-slate mb-1.5">Total</label>
            <input type="number" step="0.01" formControlName="total"
                   class="w-full rounded-xl border border-gray-200 bg-gray-100 px-4 py-3 shadow-inner focus:outline-none focus:ring-2 focus:ring-ra-green">
          </div>
        </div>

        <div class="flex items-center justify-end gap-2 pt-2">
          <button type="button" (click)="cancelar.emit()"
                  class="px-4 py-2 rounded-full border border-gray-300 text-gray-700 hover:bg-gray-100">
            Cancelar
          </button>
          <button type="submit" [disabled]="guardando"
                  class="px-5 py-2.5 rounded-full bg-[#0B2C4A] text-white hover:bg-[#0A2540] shadow-md disabled:opacity-60">
            {{ guardando ? 'Guardando…' : 'Guardar cambios' }}
          </button>
        </div>
      </form>
    }
  </div>
</div>
