@if (!puedeVer) {
  <div class="mx-4 md:mx-10 mt-4 rounded-xl2 bg-white ring-1 ring-black/10 shadow-card p-6">
    <div class="text-red-600 font-semibold">No autorizado</div>
    <div class="text-sm text-gray-600 mt-1">Solo ADMIN o GERENTE.</div>
  </div>
} @else {

  <div #zoomOuter class="overflow-x-hidden">
    <div
      #zoomInner
      class="origin-top-left overflow-x-hidden"
      [style.zoom]="uiZoom"
    >
      <!-- =========================
           BARRA SUPERIOR (tipo Membresías)
      ========================== -->
      <div class="mx-4 md:mx-10 mb-2 xl:mb-4 flex flex-col 2xl:flex-row 2xl:items-start 2xl:justify-between gap-2 xl:gap-3">
        <div class="text-base sm:text-lg xl:text-xl font-semibold text-ra-slate shrink-0">
          Asesorías Nutricionales
        </div>

        <div class="w-full 2xl:w-auto flex flex-col 2xl:flex-row 2xl:items-center 2xl:justify-end gap-2 xl:gap-3 text-[11px] xl:text-[12px] leading-none min-w-0">
          <div class="w-full flex flex-wrap 2xl:flex-nowrap items-center gap-2 xl:gap-3 min-w-0">
            <div class="w-full sm:w-auto flex items-center gap-2 min-w-0">
              <label class="text-[11px] xl:text-[12px] text-ra-slate/80 whitespace-nowrap shrink-0">
                Buscar
              </label>

              <input
                type="text"
                class="w-[260px] xl:w-[240px] 2xl:w-[260px] h-8 xl:h-9 rounded-lg xl:rounded-xl border border-gray-200 bg-gray-100 px-2.5 xl:px-3 py-1.5 xl:py-2 shadow-inner text-[11px] xl:text-[12px]"
                placeholder="Nombre, ID o teléfono…"
                [(ngModel)]="terminoBuscar"
              />

              <button
                type="button"
                class="h-8 xl:h-9 px-3 rounded-md border text-[11px] xl:text-[12px] shrink-0"
                (click)="limpiarFiltro()"
                [disabled]="!terminoBuscar"
              >
                Limpiar
              </button>

              <button
                type="button"
                class="h-8 xl:h-9 px-3 rounded-md border text-[11px] xl:text-[12px] shrink-0"
                (click)="cargar()"
              >
                Recargar
              </button>
            </div>

            <div class="w-full sm:w-auto flex justify-end 2xl:justify-start">
              <button
                type="button"
                class="h-8 xl:h-9 px-4 rounded-md bg-red-600 text-white hover:bg-red-700 shadow-card text-[11px] xl:text-[12px] whitespace-nowrap"
                (click)="abrirNuevo()"
              >
                Agregar asesorado
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- =========================
           TABLA (tipo Membresías)
      ========================== -->
      <div #tablaWrap class="shadow-card rounded-xl2 mx-4 md:mx-10 bg-ra-white">
        <div class="overflow-x-hidden">
          <div
            class="min-h-[50vh] overflow-y-auto overflow-x-hidden"
            [style.maxHeight.px]="asesoriasMaxH"
          >
            <table
              class="
                w-full min-w-0 border-collapse table-fixed
                text-[10px] sm:text-[11px] lg:text-[12px] xl:text-[13px]
              "
            >
              <thead class="sticky top-0 bg-ra-grayLight/40 z-10">
                <tr>
                  <th class="py-1.5 xl:py-4 px-2 xl:px-4 text-left text-ra-slate font-semibold uppercase w-[26%]">
                    Socio
                  </th>

                  <th class="py-1.5 xl:py-4 px-2 xl:px-4 text-center text-ra-slate font-semibold uppercase w-[12%]">
                    Teléfono
                  </th>

                  @if (mostrarGimnasioCol()) {
                    <th class="py-1.5 xl:py-4 px-2 xl:px-4 text-center text-ra-slate font-semibold uppercase w-[16%]">
                      Gimnasio
                    </th>
                  }

                  <th class="py-1.5 xl:py-4 px-2 xl:px-4 text-center text-ra-slate font-semibold uppercase w-[12%]">
                    F. inicio
                  </th>

                  <th class="py-1.5 xl:py-4 px-2 xl:px-4 text-center text-ra-slate font-semibold uppercase w-[12%]">
                    F. fin
                  </th>

                  <th class="py-1.5 xl:py-4 px-2 xl:px-4 text-center text-ra-slate font-semibold uppercase w-[12%]">
                    Estado
                  </th>

                  <th class="py-1.5 xl:py-4 px-2 xl:px-4 text-center text-ra-slate font-semibold uppercase w-[112px] min-w-[112px]">
                    Acciones
                  </th>
                </tr>
              </thead>

              <tbody>
                @if (cargando) {
                  <tr>
                    <td [attr.colspan]="99" class="py-6 px-6 text-center text-ra-slate">
                      Cargando…
                    </td>
                  </tr>
                } @else if (error) {
                  <tr>
                    <td [attr.colspan]="99" class="py-6 px-6 text-center text-red-600">
                      {{ error }}
                    </td>
                  </tr>
                } @else if (!listaFiltradaSig().length) {
                  <tr>
                    <td [attr.colspan]="99" class="py-6 px-6 text-center text-ra-slate">
                      Sin resultados.
                    </td>
                  </tr>
                } @else {
                  @for (row of listaFiltradaSig(); track (idRow(row) ?? $index)) {
                    <tr class="border-t border-ra-grayLight/60 hover:bg-ra-bg">
                      <!-- Socio -->
                      <td class="py-2 xl:py-3 px-2 xl:px-4 min-w-0">
                        <div class="font-medium truncate min-w-0">
                          {{ row.socio.nombre }} {{ row.socio.apellido }}
                        </div>
                        <div class="text-[9px] sm:text-[10px] xl:text-xs text-ra-slate/70 truncate min-w-0">
                          ID: {{ row.socio.idSocio }}
                        </div>
                      </td>

                      <!-- Tel -->
                      <td class="py-2 xl:py-3 px-2 xl:px-4 text-center truncate">
                        {{ row.socio.telefono || '—' }}
                      </td>

                      <!-- Gimnasio -->
                      @if (mostrarGimnasioCol()) {
                        <td class="py-2 xl:py-3 px-2 xl:px-4 text-center">
                          <span class="inline-flex items-center gap-1 rounded-full bg-[color:var(--color-ra-azul-fuerte)]/10 text-[color:var(--color-ra-azul-fuerte)] px-2 py-0.5 text-xs">
                            <svg viewBox="0 0 24 24" class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M3 21h18M6 21V5h6v16M12 9h6v12"></path>
                            </svg>
                            <span class="max-w-[240px] truncate">
                              {{ gimnasioLabel(row) }}
                            </span>
                          </span>
                        </td>
                      }

                      <!-- Fechas -->
                      <td class="py-2 xl:py-3 px-2 xl:px-4 text-center whitespace-nowrap">
                        {{ fmt(row.fechaInicio) }}
                      </td>
                      <td class="py-2 xl:py-3 px-2 xl:px-4 text-center whitespace-nowrap">
                        {{ fmt(row.fechaFin) }}
                      </td>

                      <!-- Estado -->
                      <td class="py-2 xl:py-3 px-2 xl:px-4 text-center">
                        @if (esDesactivada(row)) {
                          <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-slate-100 text-slate-700 text-[11px] font-semibold">
                            Desactivada
                          </span>
                        } @else if (estaProgramada(row)) {
                          <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-sky-100 text-sky-800 text-[11px] font-semibold">
                            Programada
                          </span>
                        } @else if (estaVencida(row)) {
                          <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-gray-100 text-gray-700 text-[11px] font-semibold">
                            Vencida
                          </span>
                        } @else if (estaPorVencer(row)) {
                          <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-amber-100 text-amber-800 text-[11px] font-semibold">
                            Por vencer
                          </span>
                        } @else if (estaVigente(row)) {
                          <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-green-100 text-green-800 text-[11px] font-semibold">
                            Vigente
                          </span>
                        } @else {
                          <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-gray-100 text-gray-700 text-[11px] font-semibold">
                            —
                          </span>
                        }
                      </td>

                      <!-- Acciones (estilo Membresías) -->
                      <td class="py-2 xl:py-2 px-2 xl:px-0">
                        <div class="flex items-center justify-center gap-1">
                          <button
                            (click)="abrirEditar(row)"
                            class="p-1.5 rounded hover:bg-ra-grayLight/40"
                            title="Renovar / Editar"
                          >
                            <img src="iconos/editar.svg" alt="Editar" class="w-5 h-5 xl:w-8 xl:h-8" />
                          </button>

                          <button
                            (click)="desactivar(row)"
                            class="p-1.5 rounded hover:bg-amber-50 disabled:opacity-50"
                            [disabled]="!puedeDesactivar(row) || busyDesactivarId() === idRow(row)"
                            [title]="!puedeDesactivar(row) ? 'Ya está desactivada' : 'Desactivar'"
                          >
                            @if (busyDesactivarId() === idRow(row)) {
                              <span class="text-xs font-semibold text-amber-700">…</span>
                            } @else {
                              <svg viewBox="0 0 24 24" class="w-5 h-5 xl:w-8 xl:h-8 text-amber-700" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M8 6v12M16 6v12"></path>
                              </svg>
                            }
                          </button>

                          <button
                            (click)="eliminar(row)"
                            class="p-1.5 rounded hover:bg-red-50 disabled:opacity-50"
                            [disabled]="busyEliminarId() === idRow(row)"
                            title="Eliminar"
                          >
                            @if (busyEliminarId() === idRow(row)) {
                              <span class="text-xs font-semibold text-red-700">…</span>
                            } @else {
                              <img src="iconos/eliminar.svg" alt="Eliminar" class="w-5 h-5 xl:w-8 xl:h-8" />
                            }
                          </button>
                        </div>
                      </td>
                    </tr>
                  }
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Footer pequeño informativo -->
      <div class="mx-4 md:mx-10 mt-3 mb-2 flex items-center justify-between text-[11px] sm:text-xs xl:text-sm">
        <div class="text-ra-slate/80">
          Mostrando <strong>{{ listaFiltradaSig().length }}</strong> de
          <strong>{{ (listaSig().length ) }}</strong> registros
        </div>
      </div>

      <!-- Modal -->
      @if (mostrarModal()) {
        <div class="fixed inset-0 z-50 flex items-center justify-center p-4" (click)="cerrarModal()">
          <div class="absolute inset-0 bg-black/50 backdrop-blur-[2px]"></div>

          <div class="relative z-10 w-full max-w-[720px] mx-4" (click)="$event.stopPropagation()">
            <div class="bg-ra-white rounded-2xl shadow-2xl ring-1 ring-black/5">
              <app-asesoria-nutriocional-modal
                [asesoria]="editando()"
                (cancelar)="cerrarModal()"
                (guardado)="onGuardado()"
              ></app-asesoria-nutriocional-modal>
            </div>
          </div>
        </div>
      }
    </div>
  </div>
}
