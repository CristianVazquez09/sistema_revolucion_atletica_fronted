<div class="rcm-card">
  <!-- Header -->
  <div class="rcm-header">
    <h3 class="rcm-title">Resumen de venta</h3>
    <button class="rcm-icon-btn rcm-close" (click)="cancelar.emit()" aria-label="Cerrar">
      <svg viewBox="0 0 24 24" class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>
  </div>

  <!-- Fecha (igual formato que compra) -->
  <div class="rcm-block rcm-block--small">
    <div class="rcm-row">
      <span class="rcm-label">Fecha</span>
      <span class="rcm-value">{{ (fecha || '') | date:'dd/MM/yyyy' }}</span>
    </div>
  </div>

  <!-- Items -->
  <div class="rcm-block">
    <div class="font-semibold mb-2">Artículos</div>

    <div *ngIf="items.length === 0" class="text-sm text-gray-600">Sin artículos.</div>

    <div *ngFor="let it of items" class="rcm-item">
      <div class="truncate">
        {{ it.nombre }}
        <span class="text-gray-500">× {{ it.cantidad }}</span>
      </div>
      <div class="rcm-amount">
        ${{ (it.precioUnit * it.cantidad) | number:'1.2-2' }}
      </div>
    </div>

    <div class="rcm-total">
      <span>Total</span>
      <span>${{ total | number:'1.2-2' }}</span>
    </div>
  </div>

  <!-- Pagos por método (idéntico a compra, con los 4 botones) -->
  <div class="rcm-block">
    <div class="rcm-toolbar">
      <label class="rcm-paylabel">Pagos por método</label>

      <div class="rcm-toolbar-actions">
        <button type="button" class="rcm-btn rcm-btn--blue" (click)="llenarExactoEn('EFECTIVO')">
          <svg viewBox="0 0 24 24" class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="6" width="18" height="12" rx="2"></rect>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
          Efectivo exacto
        </button>

        <button type="button" class="rcm-btn rcm-btn--blue" (click)="llenarExactoEn('TARJETA')">
          <svg viewBox="0 0 24 24" class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="5" width="20" height="14" rx="2"></rect>
            <path d="M2 10h20"></path>
          </svg>
          Tarjeta exacto
        </button>

        <button type="button" class="rcm-btn rcm-btn--blue" (click)="llenarExactoEn('TRANSFERENCIA')">
          <svg viewBox="0 0 24 24" class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 7h11l-3-3m3 3-3 3"></path>
            <path d="M20 17H9l3 3m-3-3 3-3"></path>
          </svg>
          Transferencia exacto
        </button>

        <button type="button" class="rcm-btn rcm-btn--ghost" (click)="vaciar()">
          <svg viewBox="0 0 24 24" class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18M8 6V4h8v2M6 6l1 14h10l1-14"></path>
          </svg>
          Vaciar
        </button>
      </div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 md:gap-4">
      <div class="rcm-input">
        <label class="rcm-input-label">Efectivo</label>
        <input
          type="text"
          inputmode="decimal"
          pattern="[0-9]*[.,]?[0-9]*"
          [(ngModel)]="efectivoStr"
          name="efectivo"
          class="rcm-input-el"
          placeholder="0.00">
      </div>

      <div class="rcm-input">
        <label class="rcm-input-label">Tarjeta</label>
        <input
          type="text"
          inputmode="decimal"
          pattern="[0-9]*[.,]?[0-9]*"
          [(ngModel)]="tarjetaStr"
          name="tarjeta"
          class="rcm-input-el"
          placeholder="0.00">
      </div>

      <div class="rcm-input">
        <label class="rcm-input-label">Transferencia</label>
        <input
          type="text"
          inputmode="decimal"
          pattern="[0-9]*[.,]?[0-9]*"
          [(ngModel)]="transferenciaStr"
          name="transferencia"
          class="rcm-input-el"
          placeholder="0.00">
      </div>
    </div>

    <!-- Validación de suma (idéntica a compra) -->
    <div class="mt-3 md:mt-4 text-sm flex items-center justify-between">
      <div [ngClass]="{ 'text-green-700': pagosValidos, 'text-red-600': !pagosValidos }">
        Suma de pagos:
        <strong>${{ sumaPagos | number:'1.2-2' }}</strong>
        <span *ngIf="!pagosValidos">
          • Falta/Excede: ${{ diferencia | number:'1.2-2' }}
        </span>
      </div>
      <div class="text-xs text-gray-500">
        Total: ${{ total | number:'1.2-2' }}
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="rcm-footer">
    <button
      (click)="confirmarPago()"
      [disabled]="guardando || items.length === 0 || !pagosValidos"
      class="rcm-cta rcm-cta--blue"
    >
      {{ guardando ? 'Guardando…' : 'Confirmar' }}
    </button>

    <div class="mt-2 text-center">
      <button type="button" class="text-sm text-gray-600 hover:underline" (click)="cancelar.emit()">Cancelar</button>
    </div>
  </div>
</div>
