<!-- Encabezado -->
<div class="mx-2 md:mx-6 lg:mx-8 mb-4 flex items-center justify-between">
  <h1 class="text-2xl font-bold text-brand-slate">Categorías</h1>

  <!-- Reemplaza topbar-btn--red -->
  <a routerLink="/pages/inventario"
     class="px-4 py-2 rounded-md shadow-card text-white bg-blue-900 hover:bg-[color:var(--color-ra-rojo-fuerte)]">
    Volver a productos
  </a>
</div>

<!-- Card formulario (crear/editar en el mismo componente) -->
<div class="mx-2 md:mx-6 lg:mx-8 mb-6 card">
  <div class="card-header flex items-center justify-between">
    <div class="flex items-center gap-3">
      <h2 class="text-xl font-semibold text-brand-slate">
        {{ esEdicion ? 'Editar categoría' : 'Agregar categoría' }}
      </h2>
      @if (esEdicion) {
        <span class="tag tag-green">Editando ID: {{ idEditando }}</span>
      }
    </div>
    
  </div>

  <form class="p-6 space-y-3" [formGroup]="form" (ngSubmit)="guardar()">
    <div>
      <input formControlName="nombre" class="input-filled" placeholder="Nombre de la categoría*">
      @if (form.controls.nombre.touched && form.controls.nombre.invalid) {
        <div class="text-sm text-red-600 mt-1">El nombre es obligatorio (máx. 80).</div>
      }
    </div>

    <div class="flex justify-end gap-2">
      @if (esEdicion) {
        <button type="button" (click)="cancelarEdicion()" class="px-4 py-2 rounded-md bg-ra-rojo-oscuro text-ra-white hover:bg-ra-green2 shadow-card inline-flex items-center gap-2">Cancelar</button>
      }
      <button type="submit" [disabled]="guardando" class="px-4 py-2 rounded-md bg-blue-800 text-ra-white hover:bg-ra-green2 shadow-card inline-flex items-center gap-2">
        {{ guardando ? 'Guardando…' : (esEdicion ? 'Actualizar' : 'Guardar') }}
      </button>
    </div>
  </form>
</div>

<!-- Tabla categorías (sin clases nuevas) -->
<div class="shadow-card rounded-xl2 overflow-hidden mx-2 md:mx-6 lg:mx-8 bg-white ring-1 ring-black/10">
  <div class="overflow-x-auto">
    <table class="w-full table-fixed">
      <colgroup>
        <col class="w-[18%]">
        <col class="w-[64%]">
        <col class="w-[18%]">
      </colgroup>

      <thead>
        <tr class="bg-[color:var(--color-ra-grayLight)]/40">
          <th class="py-4 px-6 text-left font-semibold uppercase text-[color:var(--color-ra-slate)]">ID</th>
          <th class="py-4 px-6 text-left font-semibold uppercase text-[color:var(--color-ra-slate)]">Nombre</th>
          <th class="py-4 px-6 text-center font-semibold uppercase text-[color:var(--color-ra-slate)]">Acciones</th>
        </tr>
      </thead>

      <tbody>
        @if (loading) {
          <tr><td colspan="3" class="py-6 px-6 text-center text-[color:var(--color-ra-slate)]">Cargando…</td></tr>
        } @else if (error) {
          <tr><td colspan="3" class="py-6 px-6 text-center text-red-600">{{ error }}</td></tr>
        } @else if (categorias.length === 0) {
          <tr><td colspan="3" class="py-6 px-6 text-center text-[color:var(--color-ra-slate)]">Sin resultados.</td></tr>
        } @else {
          @for (c of categorias; track c.idCategoria) {
            <tr class="border-t border-[color:var(--color-ra-grayLight)]/60 hover:bg-[color:var(--color-ra-bg)]">
              <td class="py-3 px-6">{{ c.idCategoria }}</td>
              <td class="py-3 px-6 truncate">{{ c.nombre }}</td>
              <td class="py-2 px-6">
                <div class="flex items-center justify-center gap-2">
                  <button (click)="editar(c)" class="p-2 rounded hover:bg-[color:var(--color-ra-grayLight)]/40" title="Editar">
                    <img src="/iconos/editar.svg" alt="Editar" class="w-5 h-5" />
                  </button>
                  <button (click)="eliminar(c)" class="p-2 rounded hover:bg-[color:var(--color-ra-grayLight)]/40" title="Eliminar">
                    <img src="/iconos/eliminar.svg" alt="Eliminar" class="w-5 h-5" />
                  </button>
                </div>
              </td>
            </tr>
          }
        }
      </tbody>
    </table>
  </div>
</div>

