<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-[2px] p-2 sm:p-4">
  <!-- Contenedor modal -->
  <div
    class="w-full
           max-w-[98vw]
           md:max-w-4xl
           lg:max-w-5xl
           xl:max-w-6xl
           2xl:max-w-7xl
           rounded-2xl bg-white shadow-2xl ring-1 ring-black/10
           overflow-hidden"
  >

    <!-- Header -->
    <div class="flex items-start justify-between px-4 sm:px-6 py-4 border-b border-gray-100">
      <div class="min-w-0">
        <h2 class="text-base sm:text-lg font-semibold text-[color:var(--color-ra-slate)]">
          Asesorías personalizadas
        </h2>
        <p class="text-sm text-gray-500">
          Entrenador:
          <span class="font-medium text-gray-800">
            {{ entrenador.nombre }} {{ entrenador.apellido }}
          </span>
        </p>
      </div>

      <button
        type="button"
        class="w-9 h-9 grid place-items-center rounded-full bg-red-600 text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-300"
        aria-label="Cerrar"
        (click)="onCerrar()"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>

    <!-- Body (crece y scrollea) -->
    <div class="px-4 sm:px-6 py-4">
      <div class="max-h-[78vh] md:max-h-[76vh] overflow-auto">

        @if (cargando) {
          <div class="py-10 text-center text-[color:var(--color-ra-slate)]">
            Cargando asesorías…
          </div>
        }
        @else if (error) {
          <div class="py-10 text-center text-red-600">
            {{ error }}
          </div>
        }
        @else if (!asesorias.length) {
          <div class="py-10 text-center text-[color:var(--color-ra-slate)]">
            No hay asesorías personalizadas para este entrenador.
          </div>
        }
        @else {

          <!-- =========================
               VISTA MOBILE (<= md): TARJETAS
               ========================= -->
          <div class="grid gap-3 md:hidden">
            @for (a of asesorias; track a.idAsesoriaPersonalizada) {
              <div class="rounded-2xl border border-gray-200 bg-white shadow-sm p-4">
                <div class="flex items-start justify-between gap-3">
                  <div class="min-w-0">
                    <div class="flex items-center gap-2">
                      <span class="inline-block rounded-md border border-gray-200 bg-gray-100 px-2 py-0.5 text-xs font-mono text-gray-700">
                        #{{ a.idAsesoriaPersonalizada }}
                      </span>

                      <span
                        class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-semibold"
                        [ngClass]="{
                          'bg-emerald-100 text-emerald-700': esVigente(a?.vigenteHasta),
                          'bg-gray-100 text-gray-700': !esVigente(a?.vigenteHasta)
                        }"
                      >
                        {{ esVigente(a?.vigenteHasta) ? 'Vigente' : 'No vigente' }}
                      </span>
                    </div>

                    <div class="mt-2 font-semibold text-[color:var(--color-ra-slate)] truncate">
                      {{ nombreSocio(a) }}
                    </div>

                    <div class="mt-1 text-xs text-gray-500">
                      Tel: {{ telefonoSocio(a) }}
                    </div>
                    <div class="text-xs text-gray-500 truncate">
                      {{ emailSocio(a) }}
                    </div>
                  </div>

                  <div class="text-right shrink-0">
                    <div class="text-xs text-gray-500">Precio</div>
                    <div class="font-semibold">
                      {{ a.precio | currency:'MXN':'symbol-narrow':'1.2-2' }}
                    </div>
                  </div>
                </div>

                <div class="mt-3 flex flex-wrap items-center gap-2">
                  <span class="text-xs text-gray-500">Tiempo:</span>
                  <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-semibold bg-slate-100 text-slate-700">
                    {{ labelTiempo(a.tiempo) }}
                  </span>
                </div>

                <div class="mt-3">
                  <div class="text-xs text-gray-500 mb-1">Pagos:</div>
                  @if (pagosConMonto(a.pagos).length) {
                    <div class="flex flex-wrap gap-1.5">
                      @for (p of pagosConMonto(a.pagos); track $index) {
                        <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs bg-gray-100 text-gray-700 border border-gray-200">
                          <span class="font-medium">{{ labelPago(p.tipoPago) }}:</span>
                          <span>{{ p.monto | currency:'MXN':'symbol-narrow':'1.2-2' }}</span>
                        </span>
                      }
                    </div>
                  } @else {
                    <span class="text-gray-400 text-xs">Sin pagos registrados.</span>
                  }
                </div>
              </div>
            }
          </div>

          <!-- =========================
               VISTA DESKTOP (>= md): TABLA
               ========================= -->
          <div class="hidden md:block">
            <div class="rounded-2xl border border-gray-200 overflow-hidden">
              <!-- Scroll horizontal solo si hace falta -->
              <div class="overflow-x-auto">
                <!-- tabla más “grande” y legible -->
                <table class="w-full min-w-[1100px] table-fixed text-[13px] lg:text-[14px]">
                  <colgroup>
                    <col class="w-[7%]">    <!-- ID -->
                    <col class="w-[27%]">   <!-- Socio -->
                    <col class="w-[14%]">   <!-- Tiempo -->
                    <col class="w-[30%]">   <!-- Pagos -->
                    <col class="w-[12%]">   <!-- Precio -->
                    <col class="w-[10%]">   <!-- Vigente -->
                  </colgroup>

                  <thead class="sticky top-0 z-10 bg-gray-50 border-b border-gray-200">
                    <tr class="text-xs font-semibold uppercase text-gray-600">
                      <th class="py-3 px-4 text-center">ID</th>
                      <th class="py-3 px-4 text-left">Socio</th>
                      <th class="py-3 px-4 text-left">Tiempo</th>
                      <th class="py-3 px-4 text-left">Pagos</th>
                      <th class="py-3 px-4 text-right">Precio</th>
                      <th class="py-3 px-4 text-center">Vigente</th>
                    </tr>
                  </thead>

                  <tbody>
                    @for (a of asesorias; track a.idAsesoriaPersonalizada) {
                      <tr class="border-b border-gray-100 hover:bg-[color:var(--color-ra-bg)]">
                        <!-- ID -->
                        <td class="py-4 px-4 text-center">
                          <span class="inline-block min-w-[3ch] rounded-md border border-gray-200 bg-gray-100 px-2 py-0.5 text-xs font-mono text-gray-700">
                            {{ a.idAsesoriaPersonalizada }}
                          </span>
                        </td>

                        <!-- Socio -->
                        <td class="py-4 px-4">
                          <div class="font-medium truncate">
                            {{ nombreSocio(a) }}
                          </div>
                          <div class="text-xs text-gray-500">
                            Tel: {{ telefonoSocio(a) }}
                          </div>
                          <div class="text-xs text-gray-500 truncate">
                            {{ emailSocio(a) }}
                          </div>
                        </td>

                        <!-- Tiempo -->
                        <td class="py-4 px-4">
                          <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-semibold bg-slate-100 text-slate-700">
                            {{ labelTiempo(a.tiempo) }}
                          </span>
                        </td>

                        <!-- Pagos -->
                        <td class="py-4 px-4">
                          @if (pagosConMonto(a.pagos).length) {
                            <div class="flex flex-wrap gap-1.5">
                              @for (p of pagosConMonto(a.pagos); track $index) {
                                <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs bg-gray-100 text-gray-700 border border-gray-200">
                                  <span class="font-medium">{{ labelPago(p.tipoPago) }}:</span>
                                  <span>{{ p.monto | currency:'MXN':'symbol-narrow':'1.2-2' }}</span>
                                </span>
                              }
                            </div>
                          } @else {
                            <span class="text-gray-400 text-xs">Sin pagos registrados.</span>
                          }
                        </td>

                        <!-- Precio -->
                        <td class="py-4 px-4 text-right font-semibold">
                          {{ a.precio | currency:'MXN':'symbol-narrow':'1.2-2' }}
                        </td>

                        <!-- Vigente -->
                        <td class="py-4 px-4 text-center">
                          <span
                            class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-semibold"
                            [ngClass]="{
                              'bg-emerald-100 text-emerald-700': esVigente(a?.vigenteHasta),
                              'bg-gray-100 text-gray-700': !esVigente(a?.vigenteHasta)
                            }"
                          >
                            {{ esVigente(a?.vigenteHasta) ? 'Sí' : 'No' }}
                          </span>
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Hint de overflow (solo visual, opcional) -->
            <div class="mt-2 text-xs text-gray-500 hidden xl:block">
              Consejo: si no cabe todo el ancho, puedes hacer scroll horizontal dentro de la tabla.
            </div>
          </div>
        }
      </div>
    </div>

    <!-- Footer -->
    <div class="px-4 sm:px-6 py-3 border-t border-gray-100 flex justify-end">
      <button
        type="button"
        (click)="onCerrar()"
        class="px-4 py-2 rounded-full border border-gray-300 bg-white text-gray-700 hover:bg-gray-50"
      >
        Cerrar
      </button>
    </div>
  </div>
</div>
